2009-07-15  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Session.pm: Extended abstraction with additional
	  functions to support refactoring
	* Kynetx/Actions.pm: Refactored to support new session abstraction
	* Kynetx/Logger.pm: Refactored to support new session abstraction
	* Kynetx/Log.pm: Refactored to support new session abstraction
	* Kynetx/JavaScript.pm (eval_counter): Refactored to support new
	  session abstraction 
	* Kynetx/Predicates.pm (eval_predicates): Refactored to support
	  new session abstraction 
	* Kynetx/Rules.pm: Refactored to support new session abstraction

2009-07-10  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Session.pm: Added methods to abstract session variable.
	* Kynetx/Rules.pm (eval_ruleset): Sam added support for closure
	  registration and execution.
	* Kynetx/KOBJ.pm (datasets): Sam added support for dataset
	  registration. 

2009-07-09  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Rules.pm (eval_meta): Added support for keys in the meta
	  section 
	* Kynetx.pm (handler): Modified method/RID regexp to not require
	  RID for methods like version

2009-06-27  Phil Windley  <pjw@kynetx.com>

	* Kynetx/KOBJ.pm (handler): Changed to never redirect to
	  CloudFront when HTTPS

2009-06-25  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Datasets.pm (get_datasource): string arg now gets tacked
	  directly on.  Hash arg generates QUERY string
	* etc/tmpl/httpd-perl.conf.tmpl: Support for billing logs
	* Kynetx/Log.pm: Support for billing logs
	* bin/kobj_log_daemon: supports multiple logs files per machine
	  and reads config from the configuration system
	* Kynetx/Parser.pm: Support for literal hashes
	* Kynetx/PrettyPrinter.pm: Support for literal hashs
	* etc/js/0.9/krl-runtime.js: anotate_search_results now accepts
	  params to modify the what get annotated.

2009-06-22  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Configure.pm: Moving configuration into YAML file.  This
	  module reads that file and sets up the configuration.
	* etc/tmpl/httpd-perl.conf.tmpl: Changed significantly to accomadate
	  new kns_config.pm 
	* bin/install-httpd-conf.pl: Changed significantly to accomadate
	  new kns_config.pm 
	* Kynetx/Logger.pm (handler): Changed default values for rule
	  logging in callbacks
	* Kynetx/Session.pm (tie_servers): Using config that can point
	  sessions at different servers from memcached servers

2009-06-18  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Memcached.pm (get_remote_data): Beefed up content
	  retrieval with LWP instead of LWP::Simple.  Caching only if
  	  success. 

2009-06-15  Phil Windley  <pjw@kynetx.com>

	* bin/install-httpd-conf.pl: Changed to allow separate
	  inclusion of SVN config.
	* etc/tmpl/httpd-perl.conf.tmpl: Changed to allow separate
	  inclusion of SVN config.

2009-06-13  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Rules.pm (eval_ruleset): Fixed problem with how select
	  vars extend the rule environment.  
	* Kynetx/Environments.pm (extend_rule_env): Changed to support
	  extending via a hash as well as a list of keys and values.

2009-06-04  Phil Windley  <pjw@kynetx.com>

	* Kynetx/JavaScript.pm (infer_type): Changed to be pickier about
	  numbers.  Don't accept leading 0 as a number.  Added tests for
	  infer_type to javascript.t

2009-06-03  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Parser.pm: Support for regular expressions as primitives
	  and the replace operator
	* Kynetx/Operators.pm (eval_replace): Added the replace operator
	* Kynetx/JavaScript.pm (eval_js_pre): Fixed so that sequential
	  decls see previous decl's results in environment

2009-06-02  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Rules.pm (get_rule_set): Separated out selection testing
	  & var setting so we can test it. 
	* Kynetx/JavaScript.pm: Removed old way of keeping track of JS vars
	* Kynetx/Actions.pm (emit_var_decl): uses output from flatten_env now.
	* Kynetx/Environments.pm: Added flatten_env to produce vars and
	  values in properly scoped order.  

2009-05-28  Phil Windley  <pjw@kynetx.com>

	This was a major refactoring to remove the dependency on hashes
	and ad hoc namespacing from the language and use the functions in
	Environments.pm to create proper symbol tables that automatically
	handle local variables, etc.  

	* Kynetx/Actions.pm (build_one_action): Accomadate changes to rule environments.
	* Kynetx/Rules.pm: Multiple changes to create and use environments.
	* Kynetx/KOBJ.pm (get_datasets): Accomadate changes to mk_dataset_js
	* Kynetx/Datasets.pm (mk_dataset_js): Changed how dat ais returned
	  so that it can be place in environment properly
	* Kynetx/JavaScript.pm (eval_js_expr): Support for environments.
	  Added lookup_rule_env for vars

2009-05-27  Phil Windley  <pjw@kynetx.com>

	* etc/js/0.9/krl-runtime.js: Moving kvars code into eval so that
	  it might work.

2009-05-15  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Operators.pm: Moved from Pick.pm to create general
	  operator functionality.  Added 'length' operator for arrays.
	* Kynetx/JavaScript.pm: general operators
	* Kynetx/PrettyPrinter.pm (pp_expr): general operator support
	* Kynetx/Parser.pm: Updated 'pick' to be a general operator with
	  variable rands

2009-05-11  Phil Windley  <pjw@kynetx.com>

	* Kynetx/PrettyPrinter.pm (pp_meta_item): Updated to support name
	  and author in meta section 
	* Kynetx/Parser.pm: Updated to support name and author in meta section
	* Kynetx.pm (describe_ruleset): Updated to return new data (name
	  and author) in the describe method

2009-05-07  Phil Windley  <pjw@kynetx.com>

	* t/Comments.t: Tests for remove_comments
	* Kynetx/Parser.pm (remove_comments): Added support for extended
	  quotes

2009-05-06  Phil Windley  <pjw@kynetx.com>

	* etc/tmpl/httpd-perl.conf.tmpl: Updated to reference 20090506
	  version of the runtime library
	* etc/js/0.9/kgrowl-1.0.js: Fixed position for IE
	* etc/js/0.9/krl-runtime.js: Changed how CSS is inserted.
	* Kynetx/Datasets.pm (get_datasource): Removing newlines from
	  non-JSON sources
	* Kynetx/Environments.pm: Added & developed module for general
	  symbol tables; not yet in use.
	* Kynetx/Actions.pm: Changed action JS to support general jQuery
	  selectors
	

2009-05-04  Phil Windley  <pjw@kynetx.com>

	* Kynetx.pm: Added method names to logging for all methods
	* etc/tmpl/httpd-perl.conf.tmpl: Added method names to logging
	* Kynetx/Rules.pm (eval_ruleset): Moved logging to outer most
	  level in ruleset evaluation.
	* Kynetx/Log.pm (log_rule_fire): Fixed bug that kept logging from
	  working when no ruleset was selected

2009-04-29  Phil Windley  <pjw@kynetx.com>

	* etc/tmpl/httpd-perl.conf.tmpl: changed path for callback API to
	  include "callback"
	* etc/js/0.9/krl-runtime.js: updates to annotate_search_results to
	  account for Google's new AJAXian SERP.  
	* Kynetx/Logger.pm (process_action): Changed how redirect is done.
	* Kynetx/Actions.pm: Updated annotate_search_results to include
	  callback function in call.  

2009-04-25  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Rules.pm (eval_globals): Added css statement to globals
	* Kynetx/Parser.pm: Added css statement to globals
	* Kynetx/Actions.pm: Added new action for closing notifications.

2009-04-23  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Rules.pm (eval_ruleset): Reset 'rule' name for each
	  ruleset for logging (MDC->put)
	* Kynetx/Actions.pm (build_one_action): Added support for native
	  config params
	* etc/js/0.9/kobj-extras.js: Change annotate_search_results to use
	  native config parameters.

2009-04-11  Phil Windley  <pjw@kynetx.com>

	* Kynetx/RuleManager.pm (lint_rule): Added some inital validation
  	  checking for rules on parsing to try and catch invalid select
	  patterns. 
	* Kynetx/Datasets.pm (mk_dataset_js): Changed dataset JS to store
	  in the KOBJ obj rather than as a standard var.
	* Kynetx/KOBJ.pm: Added data set definition defenses.
	* Kynetx/JSONPath.pm: Added to support pick expressions with
	  JSONPath patterns.  
	* Kynetx/JavaScript.pm (gen_js_expr): Added support for pick expressions.
	* Kynetx/Pick.pm: Added support for JSONPath based picks
	* Kynetx/PrettyPrinter.pm: Changes to support Parser changes.
	* Kynetx/Parser.pm: Support for new "pick" expression.  Pre decl is
	  now optional.


2009-04-04  Phil Windley  <pjw@kynetx.com>

	* extras/pilot/chrome/content/pilot/pilotOverlay.js: Modified to
	  support new initialziation sequence.
	* Kynetx/RuleManager.pm (handler): Updated to support multiple
	  ruleset evaluations in a single call.
	* Kynetx/KOBJ.pm: Removed KOBJ code.  Added datasets method.
	  Changed kobj.js generation to support new model for backwards
	  compatibility. 
	* etc/js/0.9/kobj-extras.js: Combined KOBJ code and updated to run
	  KOBJ.eval based on a configuration object

2009-04-03  Phil Windley  <pjw@kynetx.com>

	* Kynetx/RuleManager.pm: Fixed error reporting in parse API
	* Kynetx/Parser.pm: Fixed error reporting for component parsing in
	  support of parse API
	* etc/tmpl/httpd-perl.conf.tmpl: Load different startup file for KRL
	* startup-krl.pl: added new startup for KRL.  Patch until we redo
	  the respository

2009-03-27  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Rules.pm (eval_rule): Wrapped generated JS in function
	  application to create namespace on the cheap to get ready for
	  multiple ruleset evaluations on a single page.
	* Kynetx/Actions.pm (build_one_action): updated setTimeout to use
  	  function instead of string so that we can use closure to capture
	  callbacks.
	* t/Actions.t: updated test for new setTimeout call.

2009-03-26  Phil Windley  <pjw@kynetx.com>

	* Kynetx/KOBJ.pm: refactored code that interprets API from URL
	  path info.  Added dispatch method and support code for returning
	  dispatch domain info.
	  (get_kobj): Fixed KOBJ for double loads.  Fixed KOBJ.host to be
	  more rebust.

2009-03-23  Phil Windley  <pjw@kynetx.com>

	* Kynetx/RuleManager.pm: Added parsing and unparsing methods for
	  meta and dispatch directives

2009-03-20  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Repository.pm: Added to provide interface code (moved
	  from Rules.pm) for repository.
	* startup.pl: Added "use" for all major Kynetx libraries.
	* Kynetx/Datasets.pm: Added support for user declared datasets.
	* Kynetx/Request.pm: Generalized support for API path parsing and
	  bulkding the request envionment.
	* Kynetx/RuleManager.pm: Added generalized support for parsing and
	  unparsing rulesets, rules, and global decls in support of
	  Intersekt improvements.

2009-02-13  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Parser.pm: Added support for logging pragma
	* Kynetx/Util.pm: Redid config_logging() to remove external
	  configuration files and added turn_on_logging() to support
	  logging pragma
	* pilot/pilotOverlay.js: Added test mode support code
	* pilot/pilotOverlay.xul: Added menu items for test mode.
	* Kynetx/Rules.pm (get_rule_set): Turn on logging when logging
	  pragma present
	* Kynetx/KOBJ.pm (get_kobj): Fixed bug with parameter pass thru

2009-02-10  Phil Windley  <pjw@kynetx.com>

	* etc/js/0.9/kgrowl-1.0.js: Added default value for opacity.  This
	  allows it to be changed.

2009-01-22  Phil Windley  <pjw@kynetx.com>

	* etc/tmpl/httpd-perl.conf.tmpl: Added config var for kobj_dir
	* bin/install-httpd-conf.pl: New was to calculate base dir from
	  where the program runs.
	* Kynetx/Version.pm: Added version functions
	* t/Version.t: Added tests for version number
	* t/dev/rules.t: Added pragma to ensure symbolic links are followed
	* t/dev/use.t: Added pragma to ensure symbolic links are followed

2009-01-12  Phil Windley  <pjw@kynetx.com>

	* bin/update.pl: Removed use of HTTP directives for
	  memcache configuration.
	* bin/install-httpd-conf.pl: Removed use of HTTP directives for
	  memcache configuration.
	* etc/tmpl/httpd-perl.conf.tmpl: Removed use of HTTP directives for
	  memcache configuration.
	* Kynetx.pm (handler): Removed use of HTTP directives for
	  memcache configuration.
	* Kynetx/Logger.pm (handler): Removed use of HTTP directives for
	  memcache configuration.
	* Kynetx/Memcached.pm: Gets memcached hosts from the
	  /web/etc/memcache_ips file instead of the http.conf file. This
	  allows better puppet configuration control.  

2009-01-10  Phil Windley  <pjw@kynetx.com>

	* Kynetx/PrettyPrinter.pm: Added support for meta block and description block
	* Kynetx/Parser.pm: Added support for meta block and description block
	* Kynetx.pm (describe_ruleset): Added "describe" method to hander
	* Kynetx/Rules.pm (get_rules_from_repository): Save ruleset verion
	  in memcached and retrieve it when you get rules from cache
	* t/cs.t: Added tests for the DESCRIBE method

2009-01-08  Phil Windley  <pjw@kynetx.com>

	* Kynetx.pm (handler): Fixed "flush" $site regexp to work with
	  non-numeric site ids
	* Kynetx/Console.pm: Fixed $site regexp to work with non-numeric
	  site ids
	* t/cs.t: Added tests for running ruleset server

2009-01-06  Phil Windley  <pjw@kynetx.com>

	* bin/update.pl: removed an incorrect switch from the call to
	  install-init-files.pl 

	* Kynetx/KOBJ.pm: Modified KOBJ.obs to work on clicks with inner HTML
	* bin/install-init-files.pl: Made Amazon S3 save optional and
	  restored file save for local files in case S3 isn't available.  
	

2009-01-05  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Logger.pm: Added info field to callback logging
	* Kynetx/Parser.pm: Added notify action
	* Kynetx/Actions.pm: Added notify action

2008-12-08  Phil Windley  <pjw@kynetx.com>

	* Kynetx/KOBJ.pm (get_kobj): Added "static" URL for static file
	  that redirects to CloudFront.

2008-11-26  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Rules.pm (process_rules): Changes to support non-numeric
 	  ruleset IDs.  

2008-10-30  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Parser.pm: Added labels to emits.
	* Kynetx/Action.pm: Added callback calls and logging labels to emits

2008-10-28  Phil Windley  <pjw@kynetx.com>

	* Kynetx/KOBJ.pm (get_kobj): Updated the KOBJ.get_host function to
	  ignore protocol if present.  

2008-10-06  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Actions.pm: Replaced all actions with JQuery-based
	  equivalents.  
	* Kynetx/KOBJ.pm: now sends JQuery JS libraries.  Version 0.9. 

2008-10-02  Phil Windley  <pjw@kynetx.com>

	* Kynetx/KOBJ.pm (get_kobj): wrapped Prototype effects for future
	  portability.  
	* widgets/weather.pl: Updated to use new wrapped effects

	* Kynetx/JavaScript.pm, Kynetx/KOBJ.pm, Kynetx/Actions.pm: updated
	  to use new K$ function in kobj-static.js rather than original $
	  function.  
	* install-init-files.pl: modifies stock Prototype files to change
	  $ function it K$ function.  

2008-09-23  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Rules.pm (eval_rule): made sure null rule conditions are true

2008-09-22  Phil Windley  <pjw@kynetx.com>

	* Kynetx/JavaScript.pm (eval_datasource): added support for page IDs
	* Kynetx/Parser.pm: added syntax for 'emit'
	* Kynetx/Actions.pm: Added code to emit Javascript.
	* Kynetx/Actions.pm: Added support for change highlighting effect

2008-09-18  Phil Windley  <pjw@kynetx.com>

	* Parser rewrite complete.  Page variables added as a data source.
	76 files touched.  Ugh.   

2008-09-11  Phil Windley  <pjw@kynetx.com>

	* Kynetx/PrettyPrinter.pm: Rewrote to match changes to
  	  Parser.pm. Restructured expression syntax tree to be consistent
	  with predicates and easier to use.  

	* Kynetx/Parser.pm: Completely rewrote parser using RecDescent
	  Added new productions for predicate expressions, qualified data
	  functions and predicates, and value comparison in predicates.

2008-08-26  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Actions.pm: Fixed numerous problems that made floats not
 	  work with IE.

2008-08-25  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Actions.pm: Fixed error in action hash

	* etc/tmpl/httpd-perl.conf.tmpl: Added static P3P compact policy
	  header 

	* Kynetx/KOBJ.pm (get_kobj): Added support for private domains and
  	  more robust caller determination

2008-08-19  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Predicates.pm (eval_predicates): Changed "exists" to
 	  "defined" when checking for counter predicate timeframes

2008-08-08  Phil Windley  <pjw@kynetx.com>

	* t/JavaScript.t (mk_datasource_function): added test for all
	  datasources
	* Kynetx/Location.pm new predicates for international in 
	* Kynetx/Actions.pm new actions for moving elements

2008-07-17  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Session.pm (tie_servers): Sessions now using memcached
	for session storage rather than /web/data...  This is in
	anticipation of using memcachedb for session storage.
	
	* Kynetx/Predicates/MediaMarkets.pm: New predicates on functions
	surrounding the use of DMA codes to determine media markets

	* extras/dma/mk_db.pl: creates a DBX file for DMA codes

2008-07-10  Phil Windley  <pjw@kynetx.com>

	* Kynetx/Predicates/Referers.pm: Fixed remote and local referers
	* Kynetx/Predicate.pm: invalid predicates give warning now
	* t/Predicates/Markets.t: Made tests more realistic
	* Kynetx/Javascript.pm: Fixed bug in how args were passed to get_stocks

2008-07-02  Phil Windley  <pjw@kynetx.com>

	* bin/update.pl: Added support for fragment servers
	* Kynetx/JavaScript.pm: Added eval_js_expr to reduce a JS
	expression to a simple string, int, etc.   This is used in
	Actions.pm before grabbing a URL expression on the server.
	* Kynetx/Actions.pm (build_js_load): Run gen_js_pre before
	building rule_env so that decls get into rule_env as well as in
	the JS load.  
	* Kynetx/Actions.pm (choose_action): when we grab a URL, we eval
	it first in case it's an expression
	* Kynetx/Predicates/Time.pm (get_local_time): removed quotes from
	arg in timezone predicate
	* Kynetx/Predicates/Referers.pm (referer_domain): removed quotes
	from arg in timezone predicate
	* Kynetx/Session.pm (tie_servers): sessions now use memcached
	protocol.  At present they're configured to use the memcached
	servers, but they will eventually point to a memcachedb setup. 
	
	
2008-06-19  Phil Windley  <pjw@kynetx.com>

	* bin/update.pl: added this to make updating servers easier
	* added tests to Predicate file
	* fixed a few small bugs in predicates

2008-06-16  Phil Windley  <pjw@kynetx.com>

	* added the Mobile module and tests.  Adds the predicate
	'mobile()' which checks to see if the user agent is mobile.




