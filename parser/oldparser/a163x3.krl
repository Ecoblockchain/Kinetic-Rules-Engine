{"global":[{"content":"div.kGrowl-notification.default {\n          border: 2px solid silver;\n        }\n        .KOBJ_header {\n          border-bottom: 1px solid silver;\n        }\n        .KOBJ_message {\n          text-align: center;\n        }\n        .left {\n          text-align: left;\n        }\n        .KOBJ_message a {\n          color: black;\n        }\n        .KOBJ_message a img {\n          border: 1px solid white;\n        }\n        .KOBJ_message a:hover img {\n          border: 1px solid silver;\n        }\n        .total {\n          font-weight: bold;\n          color: blue;\n        }\n        tr.amzn {\n          background-color: #f4a032;\n        }\n      ","type":"css"}],"global_start_line":21,"dispatch":[{"domain":"booklist.byu.edu","ruleset_id":null},{"domain":"www.amazon.com","ruleset_id":null}],"dispatch_start_col":5,"meta_start_line":2,"rules":[{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"action":{"source":null,"name":"append","args":[{"val":"body","type":"str"},{"val":"msg","type":"var"}],"modifiers":null,"vars":null},"label":null},{"action":{"source":null,"name":"watch","args":[{"val":"#isbnForm","type":"str"},{"val":"submit","type":"str"}],"modifiers":null,"vars":null},"label":null},{"label":null,"emit":"var isbn = new Array();\n          var row_num = -1;\n          $K.each($K(\"#Content table\").contents().find(\"tr\"), function(i, val) {\n            if (row_num >= 0) {\n              var item = $K(val).find('td:nth-child(4)');\n              isbn.push(item.text());\n              //Add this to an input\n              $K(\"#isbnForm\").append('<input type=\"text\" name=\"isbnList[' + row_num + ']\" value=\"' + item.text() + '\" />');\n            }\n            row_num++;\n          });\n          $K(\"[name=isbn]\").trigger(\"submit\");\n\n          var url_amazon = 'http://www.amazon.com/s/ref=sdp_tx_is'\n            + '?ie=UTF8&search-alias=stripbooks&field-isbn='\n            + isbn.join('|')\n            + '&rank=%2Brelevancerank';\n          var url_bn = 'http://search.barnesandnoble.com/booksearch/batchresults.asp'\n            + '?TXT=Y&txtISBNList='\n            + isbn.join(',');\n          var url_half = 'http://books.half.ebay.com/ws/web/HalfISBNSearch?isbn='\n            + isbn.join('+');\n          var url_textbooks = 'http://www.textbooks.com/Search.php?isbn='\n            + isbn.join('+');\n\n          var img_front = '<img src=\"https://snay2-posts.s3.amazonaws.com/BookComparison/';\n          var img_back = '\" />';\n          var img_amazon = img_front + 'amazon.png' + img_back;\n          var img_bn = img_front + 'bn.png' + img_back;\n          var img_half = img_front + 'half_com.png' + img_back;\n          var img_textbooks = img_front + 'textbooks_com.png' + img_back;\n\n          var message = 'Find these books from other sources:'\n            + '<br /><br /><a href=\"' + url_amazon + '\" target=\"_blank\">' + img_amazon + '</a>'\n            + '<br /><br /><a href=\"' + url_bn + '\" target=\"_blank\">' + img_bn + '</a>'\n            + '<br /><br /><a href=\"' + url_half + '\" target=\"_blank\">' + img_half + '</a>'\n            + '<br /><br /><a href=\"' + url_textbooks + '\" target=\"_blank\">' + img_textbooks + '</a>';\n        "},{"action":{"source":null,"name":"notify","args":[{"val":"Compare prices online","type":"str"},{"val":"message","type":"var"}],"modifiers":[{"value":{"val":"true","type":"bool"},"name":"sticky"},{"value":{"val":"white","type":"str"},"name":"background_color"},{"value":{"val":"black","type":"str"},"name":"color"},{"value":{"val":"1.0","type":"str"},"name":"opacity"},{"value":{"val":"top-left","type":"str"},"name":"pos"}],"vars":null},"label":null}],"post":null,"pre":[{"rhs":"<div style=\"display: none;\">\n            <form id=\"isbnForm\" onsubmit=\"return false\">\n              <input name=\"isbn\" value=\"nonsense\" />\n              <input type=\"submit\" />\n            </form>\n          </div>\n        ","lhs":"msg","type":"here_doc"}],"name":"booklist","start_col":5,"emit":null,"state":"active","callbacks":null,"pagetype":{"event_expr":{"domain":null,"pattern":"booklist.byu.edu/ry/mybooks.cfm","type":"prim_event","vars":[],"op":"pageview"},"foreach":[]},"start_line":55},{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"action":{"source":null,"name":"replace","args":[{"val":"#amzn_#{isbn}","type":"str"},{"val":"isbn","type":"var"}],"modifiers":null,"vars":null},"label":null}],"post":null,"pre":null,"name":"handle_submit","start_col":5,"emit":"KOBJ.log('ISBN: ' + isbn);\n      ","state":"inactive","callbacks":null,"pagetype":{"event_expr":{"on":null,"domain":"web","type":"prim_event","vars":null,"op":"submit","element":"#isbnForm"},"foreach":[{"expr":{"source":"page","predicate":"param","args":[{"val":"isbnList","type":"str"}],"type":"qualified"},"var":["isbn"]}]},"start_line":122},{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"action":{"source":null,"name":"notify","args":[{"val":"Prices at Amazon.com","type":"str"},{"val":"message","type":"var"}],"modifiers":[{"value":{"val":"true","type":"bool"},"name":"sticky"},{"value":{"val":"white","type":"str"},"name":"background_color"},{"value":{"val":"black","type":"str"},"name":"color"},{"value":{"val":"1.0","type":"str"},"name":"opacity"}],"vars":null},"label":null}],"post":null,"pre":null,"name":"amazon","start_col":5,"emit":"var new_prices = new Array();\n        $K.each($K(\".listView\").contents().find(\".newPrice\"), function(i, val) {\n          var price = $K(val).find(\"span\").text();\n          new_prices.push(parseFloat(price.substring(1, price.length)));\n        });\n        var total_new = 0;\n        for (var i = 0; i < new_prices.length; i++) {\n          total_new += new_prices[i];\n        }\n        var used_prices = new Array();\n        $K.each($K(\".listView\").contents().find(\".usedNewPrice\"), function(i, val) {\n          var price = $K(val).find(\".subPrice:nth-child(2) span\").text();\n          used_prices.push(parseFloat(price.substring(1, price.length)));\n        });\n        var total_used = 0;\n        for (var i = 0; i < used_prices.length; i++) {\n          total_used += used_prices[i];\n        }\n        total_new = \"$\" + total_new.toFixed(2);\n        total_used = \"$\" + total_used.toFixed(2);\n        var message = '<div class=\"left\">Below are the totals for these textbooks at Amazon.com:'\n          + '<br /><br />All books new: <span class=\"total\">' + total_new + '</span>'\n          + '<br />All books used: <span class=\"total\">' + total_used + '</span>'\n          + '<br /><br />Compare these prices with those at the Bookstore. '\n          + 'Note that some books may only be available at the Bookstore.</div>';\n      ","state":"inactive","callbacks":null,"pagetype":{"event_expr":{"domain":null,"pattern":"www.amazon.com/s/ref=sdp_tx_is","type":"prim_event","vars":[],"op":"pageview"},"foreach":[]},"start_line":134}],"meta_start_col":5,"meta":{"keys":{"amazon":{"secret_key":"g5AMoIAYZRWMRV3ciw6NXZBHZo85zU430qBFF8fl","token":"AKIAIG4AHOQYTZZHFLHQ"}},"logging":"on","name":"BookComparison","meta_start_line":2,"author":"Steven Nay","description":"Mashes up a student's BYU Bookstore \"booklist\" with Amazon.com alternatives     \n      ","meta_start_col":5},"dispatch_start_line":16,"global_start_col":5,"ruleset_name":"a163x3"}
