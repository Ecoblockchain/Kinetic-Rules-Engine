{"global":[],"global_start_line":null,"dispatch":[{"domain":"ipac.slco.lib.ut.us","ruleset_id":null}],"dispatch_start_col":5,"meta_start_line":2,"rules":[{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"action":{"source":null,"name":"notify","args":[{"val":"Current Availability","type":"str"},{"val":"#{spignet.get_libitem_availability()}","type":"str"}],"modifiers":[{"value":{"val":"true","type":"bool"},"name":"sticky"}]},"label":null}],"post":null,"pre":null,"name":"slc_book_dvd_availability","start_col":5,"emit":"var DVD = 2;    var BOOK = 1;    var AUDIOBOOK = 3;      var availability = \"no availability determined\";    var holds = 0;    var available = 0;    var format = null;      var spignet = {      get_libitem_availability: function() {        $K(\"td\").each(function() {          if ($K(this).text().match(/^Holds/)) {            holds = $K(this).parent().text().match(/\\d+/);          }          if ($K(this).text().match(/^Available/)) {            available = $K(this).parent().text().match(/\\d+/);          }          if (format == null && $K(this).parent().text().match(/^Format/)) {            if ($K(this).parent().html().match(/ipac_dvd\\.jpg/)) {              format = DVD;            }            else if ($K(this).parent().html().match(/ipac_book_icon\\.gif/)) {              format = BOOK;            }          }        });          if (available > 0) {                  if (holds < available) {            availability = \"Available Now\";          }                  else if (available >= holds/2) {            availability = \"Short Wait\";          }                  else if (available < holds/2) {            availability = \"Long Wait\";          }        }        console.log(availability);        return availability;      }    };          ","state":"active","callbacks":null,"pagetype":{"event_expr":{"pattern":"http://ipac\\.slco\\.lib\\.ut\\.us\\/.*link=","legacy":1,"type":"prim_event","vars":[],"op":"pageview"},"foreach":[]},"start_line":13}],"meta_start_col":5,"meta":{"logging":"off","name":"Salt Lake County Item Availability","meta_start_line":2,"author":"Steve Spigarelli","description":"Show availability for items at the Salt Lake County Library    \n","meta_start_col":5},"dispatch_start_line":10,"global_start_col":null,"ruleset_name":"a54x1"}
