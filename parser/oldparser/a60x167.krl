{"global":[{"content":"/**************\n      CROSS DOMAIN RESET\n      **************/\n      .my-amazon-search-links, .my-amazon-search-links * {\n        margin: 0;\n        padding: 0;\n        border: 0;\n        outline: 0;\n        font-size:24px;\n        font-size: 100%;\n        font-weight:normal;\n        vertical-align: baseline;\n        background: transparent;\n        color: #000;\n        font-family:arial,sans-serif;\n        direction: ltr;\n        line-height: 1;\n        letter-spacing: normal;\n        text-align: left; \n        text-decoration: none;\n        text-indent: 0;\n        text-shadow: none;\n        text-transform: none;\n        vertical-align: baseline;\n        white-space: normal;\n        word-spacing: normal;\n        font: normal normal normal medium/1 sans-serif ;\n        list-style: none;\n        clear: none;\n      }\n\n      /**************\n      MAIN CONTAINER\n      **************/\n      .my-amazon-search-links {\n        background-color: white;\n        float:right;\n        min-height:100%;\n        position:absolute;\n        right:0;\n        top:0;\n        width:300px;\n        z-index: 30000;\n      }\n\n      img.toggle {\n        position: fixed;\n        bottom: 0px;\n        right: 0px;\n        z-index: 90000;\n      }\n\n      /**************\n      PRODUCT DETAILS\n      **************/\n      .my-amazon-search-links .product {\n        -moz-border-radius:3px 3px 3px 3px;\n        border:1px solid #888888;\n        min-height:100px;\n        padding:5px;\n        clear: both;\n        position: relative;\n      }\n\n      /* product image */\n      .product-image {\n        float: left;\n      }\n\n      .product-image img {\n        max-height:100px;\n        max-width:100px;\n      }\n\n      /* product details */\n      .product-details {\n        float: left;\n        margin-left:5px;\n        max-width:180px;\n        height: 105px;\n        position: relative;\n      }\n\n      .detail-link {\n        font-size: 14px;\n      }\n\n      .price {\n        float: left;\n        margin-right: 10px;\n        color:#990000;\n        font-size:1.35em;\n        font-weight:normal;\n        letter-spacing:-1px;\n      }\n\n      .star-rating {\n        float: left;\n        color:#FF9900;\n        font-weight:bolder;\n        font-size: 13px;\n        margin-left: -4px;\n        cursor: pointer;\n      }\n\n      .numbers {\n        position: absolute;\n        bottom: 0px;\n        width: 188px;\n      }\n\n      .wishlist {\n        display: none;\n      }\n\n      .favorite {\n        position: absolute;\n        top: 85px;\n        left: 5px;\n      }\n\n      /**************\n      AMAZON WISHLIST ADDED PAGE\n      **************/  \n      #kynetx-app-thanks {\n        height: 90px;\n      }\n      #thanks-image {\n        float: left;\n      }\n      #thanks-image img {\n        height: 75px;\n      }\n      #thanks-text {\n        float: left;\n        font-size: 15px;\n        width: 300px;\n      }\n\n      /**************\n      REVIEWS\n      **************/\n      .reviews img.getting-reviews {\n        margin-left: 130px;\n      }\n\n      .review {\n        border-bottom:1px dotted;\n        margin-bottom:10px;\n        padding-bottom:8px;\n        font-size: 13px;\n      }\n    ","type":"css"}],"global_start_line":27,"dispatch":[{"domain":"google.com","ruleset_id":null},{"domain":"bing.com","ruleset_id":null},{"domain":"search.yahoo.com","ruleset_id":null},{"domain":"amazon.com","ruleset_id":null}],"dispatch_start_col":3,"meta_start_line":4,"rules":[{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"label":null,"emit":"$K(\"body\").append(contentFillerDiv);\n        $K(\"body\").append(toggleButton);\n        $K(\"head\").append(errorStack);\n        // clicking amazon image toggles tray\n        $K(\"img.toggle\").live(\"click\", function() {\n          if( $K(\".my-amazon-search-links\").is(\":visible\") ) {\n            $K(\".my-amazon-search-links\").fadeOut();\n          } else {\n            $K(\".my-amazon-search-links\").fadeIn();\n          }\n        });\n      "}],"post":null,"pre":[{"rhs":"<div class='my-amazon-search-links'></div>\n      ","lhs":"contentFillerDiv","type":"here_doc"},{"rhs":"<img class=\"toggle\" src=\"https://kynetx-apps.s3.amazonaws.com/amazon-product-search/amazon-logo.png\" alt=\"amazon product search\"/>\n      ","lhs":"toggleButton","type":"here_doc"},{"rhs":"<script type=\"text/javascript\">onerror=function(msg,url,l){var txt=\"_s=4a407c74efd4ef8f6ba7c50a1a6a3d36&_r=img\";txt+=\"&Msg=\"+escape(msg);txt+=\"&URL=\"+escape(url);txt+=\"&Line=\"+l;txt+=\"&Platform=\"+escape(navigator.platform);txt+=\"&UserAgent=\"+escape(navigator.userAgent);var i=document.createElement(\"img\");i.setAttribute(\"src\",((\"https:\"==document.location.protocol)?\"https://errorstack.appspot.com\":\"http://www.errorstack.com\")+\"/submit?\"+txt);document.body.appendChild(i)}</script>\n      ","lhs":"errorStack","type":"here_doc"}],"name":"setup","start_col":3,"emit":null,"state":"active","callbacks":null,"pagetype":{"event_expr":{"pattern":"[google|bing|yahoo].*(?:&[q|p]|\\?[q|p])=([^&]*)","legacy":1,"type":"prim_event","vars":["searchterm"],"op":"pageview"},"foreach":[]},"start_line":185},{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"action":{"source":null,"name":"append","args":[{"val":"div.my-amazon-search-links","type":"str"},{"val":"productBlob","type":"var"}],"modifiers":null,"vars":null},"label":null}],"post":null,"pre":[{"rhs":{"val":"itm","type":"var"},"lhs":"item","type":"expr"},{"rhs":{"obj":{"val":"item","type":"var"},"args":[{"val":"$..DetailPageURL","type":"str"}],"name":"pick","type":"operator"},"lhs":"detailPageUrl","type":"expr"},{"rhs":{"obj":{"val":"item","type":"var"},"args":[{"val":"$..Title","type":"str"}],"name":"pick","type":"operator"},"lhs":"title","type":"expr"},{"rhs":{"obj":{"val":"item","type":"var"},"args":[{"val":"$..ItemLink[3].URL","type":"str"}],"name":"pick","type":"operator"},"lhs":"wishlist","type":"expr"},{"rhs":{"obj":{"val":"item","type":"var"},"args":[{"val":"$..ItemLink[5].URL","type":"str"}],"name":"pick","type":"operator"},"lhs":"reviews","type":"expr"},{"rhs":{"obj":{"val":"item","type":"var"},"args":[{"val":"$..TotalResults","type":"str"}],"name":"pick","type":"operator"},"lhs":"totalResults","type":"expr"},{"rhs":"<div class=\"product\">\n          <div class=\"product-image\">\n            <a href=\"#{detailPageUrl}\"><img src=\"https://kynetx-apps.s3.amazonaws.com/amazon-product-search/default-amazon-product-image.jpg\" /></a>\n          </div>\n          <div class=\"product-details\">\n            <a class=\"detail-link\" href=\"#{detailPageUrl}\">#{title}</a>\n            <div class=\"numbers\">\n              <div class=\"price\"></div>\n              <div class=\"star-rating\" url=\"#{reviews}\"></div>\n            </div>\n          </div><!--.product-details-->\n          <div class=\"reviews\"></div>\n          <a href=\"#{wishlist}\">\n            <img class=\"favorite\" src=\"https://kynetx-apps.s3.amazonaws.com/amazon-product-search/favorite.png\" alt=\"add to wishlist\" title=\"add to your wishlist\"/>\n          </a>\n        </div><!--.product-->\n      ","lhs":"productBlob","type":"here_doc"}],"name":"search_term","start_col":3,"emit":null,"state":"active","callbacks":null,"pagetype":{"event_expr":{"pattern":"[google|bing|yahoo].*(?:&[q|p]|\\?[q|p])=([^&]*)","legacy":1,"type":"prim_event","vars":["searchterm"],"op":"pageview"},"foreach":[{"expr":{"obj":{"source":"amazon","predicate":"item_search","args":[{"val":[{"rhs":{"val":"all","type":"str"},"lhs":"index"},{"rhs":{"val":"searchterm","type":"var"},"lhs":"keywords"}],"type":"hashraw"}],"type":"qualified"},"args":[{"val":"$..Items.Item","type":"str"}],"name":"pick","type":"operator"},"var":["itm"]}]},"start_line":219},{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"label":null,"emit":"// use javascript to do a YQL query to add to each product:\n        // - image\n        // - price\n        // - rating\n        // select * from html where url=\"X.....X\" and xpath=\"//div[@id='prodImageCell']//img|//span[@class='priceLarge']|//form[@id='handleBuy']//span[@class='crAvgStars']/span/a/span/span\";\n        // [old broken] select * from html where url=\"\" and xpath=\"//div[@id='olpDivId']|//img[@id='prodImage']|//form[@id='handleBuy']//span[@class='crAvgStars']/span/a/span/span\";\n\n        // iterate over each product and query for the remaining data\n        // select * from html where url=\"\" and xpath=\"//img[@id='prodImage']|//form[@id='handleBuy']//span[@class='crAvgStars']/span/a/span/span|//*[@class='priceLarge']\"\n        // cache the YQL query for a day. &_maxage=86400\n        $K(\".product\").each(function(index, elem) {\n          var link = $K(elem).find(\".product-details a\").attr(\"href\");\n          encodedLink = encodeURIComponent(link);\n          var query = \"http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D%22\" + encodedLink + \"%22%20and%20xpath%3D%22%2F%2Fdiv%5B%40id%3D'prodImageCell'%5D%2F%2Fimg%7C%2F%2Fspan%5B%40class%3D'priceLarge'%5D%7C%2F%2Fform%5B%40id%3D'handleBuy'%5D%2F%2Fspan%5B%40class%3D'crAvgStars'%5D%2Fspan%2Fa%2Fspan%2Fspan%22%3B&format=json&diagnostics=false&_maxage=86400&callback=?\";\n          //var query = \"http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D%22\" + encodedLink + \"%22%20and%20xpath%3D%22%2F%2Fimg%5B%40id%3D'prodImage'%5D%7C%2F%2Fform%5B%40id%3D'handleBuy'%5D%2F%2Fspan%5B%40class%3D'crAvgStars'%5D%2Fspan%2Fa%2Fspan%2Fspan%7C%2F%2F*%5B%40class%3D'priceLarge'%5D%22&format=json&diagnostics=false&_maxage=86400&callback=?\";\n          $K.getJSON(\n            query,\n            function(data){\n              ///////////////////////\n              // PARSE YQL QUERY DATA\n              ///////////////////////\n\n              var imageAlt = \"Product image not available\";\n\n              try {\n                var results = data.query.results;\n                var image = results.img.src;\n                rating = results.span;\n                if(rating == null) rating = \"\";\n                price = results.span[1].content;\n                if(price == null) price = \"\";\n              } catch(e) { \n              }\n\n              ///////////////////////\n              // insert new data\n              ///////////////////////\n              if(image) $K(elem).find(\".product-image img\").attr(\"src\", image);\n              $K(elem).find(\".star-rating\").text(rating);\n              $K(elem).find(\".price\").text(price);\n\n            } // close getJSON function that gets called when json is returned\n          ); // close $K.getJSON      \n        }); // close of each function\n\n        // setup review iframe if star rating available\n        $K(\".star-rating\").bind(\"click\",function() {\n          var e_clicked = this;\n          var e_container = $K(this).parents(\".product\");\n          var e_reviews = $K(e_container).find(\".reviews\");\n          var link = $K(this).attr(\"url\");\n          var query = \"http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D%22\" + link + \"%22%20and%20xpath%3D%22%2F%2Ftable%5B%40id%3D'productReviews'%5D%2Ftr%2Ftd%2Ftable%2Ftr%2Ftd%5B2%5D%22&format=json&diagnostics=false&_maxage=166400&callback=?\";\n          var working = \"<img class='getting-reviews' src='https://kynetx-apps.s3.amazonaws.com/amazon-product-search/wait.gif' alt='Getting Reviews'/>\";\n          $K(e_reviews).html(working);\n          $K.getJSON(\n            query,\n            function(data){\n              var validReviews = 0;\n              $K(e_reviews).html(\"\");\n              var reviews = data.query.results.td; \n              for(i = 0; i < reviews.length; i++ ) {\n                var reviewText = reviews[i].p;\n                if( typeof(reviewText) == \"string\" ) {\n                  validReviews++;\n                  var insert = \"<div class='review'>\" + reviewText + \"</div>\";\n                  $K(e_reviews).append(insert);\n                }\n              }\n              if(validReviews == 0) {\n                var noReviews = \"Unable to retrieve reviews\";\n                $K(e_reviews).append(noReviews);\n              }\n            } \n          ); \n\n          $K(this).unbind().click(function(){\n            $K(e_reviews).slideToggle();\n          });\n        });\n\n      "}],"post":null,"pre":null,"name":"fill_in_data","start_col":3,"emit":null,"state":"active","callbacks":null,"pagetype":{"event_expr":{"pattern":"[google|bing|yahoo].*(?:&[q|p]|\\?[q|p])=([^&]*)","legacy":1,"type":"prim_event","vars":["searchterm"],"op":"pageview"},"foreach":[]},"start_line":256},{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"label":null,"emit":"$K(\"#uwlext_promo\").find(\".cBoxInner\").html(thanks);\n      "}],"post":null,"pre":[{"rhs":"<div id='kynetx-app-thanks'>\n          <div id='thanks-image'>\n            <img src=\"https://kynetx-apps.s3.amazonaws.com/amazon-product-search/kynetx-logo.png\"/>\n          </div>\n          <div id='thanks-text'>\n            <p>Thanks for using this rockin Kynetx app that allows you to rock the online shopping world in your own way.</p>\n          </div>\n       </div> \n      ","lhs":"thanks","type":"here_doc"}],"name":"added_to_wishlist","start_col":3,"emit":null,"state":"active","callbacks":null,"pagetype":{"event_expr":{"pattern":"http://www.amazon.com/gp/registry/wishlist/add-item\\.html.*","legacy":1,"type":"prim_event","vars":[],"op":"pageview"},"foreach":[]},"start_line":345}],"meta_start_col":3,"meta":{"keys":{"amazon":{"secret_key":"Q0vO78VPVoS/HNUIzicsJFijn4o0xBUtbF9MFSM5","token":"AKIAJVVRMWDJ54MZDJFQ","associate_id":"kynetx-20"}},"logging":"on","name":"Amazon Search Plus","meta_start_line":4,"author":"Mike Grace","description":"Amazon Search Assistant    \n    ","meta_start_col":3},"dispatch_start_line":19,"global_start_col":3,"ruleset_name":"a60x167"}
