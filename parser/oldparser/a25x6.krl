{"global":[{"source":"http://preview.kiimby.com/biz/json","name":"kiimby_dataset","type":"dataset","datatype":"JSON","cachable":{"period":"hours","value":"23"}},{"rhs":{"val":"kiimby_dataset","type":"var"},"lhs":"sites","type":"expr"},{"emit":"/* Array associating the URLs of the kiimby members business sites with the webpage path */\n       var sites_list = new Array();\n       /* Array associating the URLs of the kiimby members business sites with the current offer/event description */\n       var sites_title = new Array();\n       /* Loop : constructs the arrays and fills with datas from the JSON dataset*/\n       for (i=0;i<sites.kiimby.length;i++) {\n           var temp_url = sites.kiimby[i].biz.url;\n           /* If the url match with a .com we add / at the end */\n           if ( temp_url.match(/com$/) != null) {\n               sites_list[temp_url + '/'] = sites.kiimby[i].biz.path;\n               sites_title[temp_url + '/'] = sites.kiimby[i].biz.offer;\n           }\n           else {\n                sites_list[temp_url] = sites.kiimby[i].biz.path;\n                sites_title[temp_url] = sites.kiimby[i].biz.offer;\n          }\n       }\n       /* Kiimby logo URL */\n       var url_prefix = \"http://preview.kiimby.com/files/\";        \n       var km_icon = \"klogo.gif\";\n       "}],"global_start_line":16,"dispatch":[{"domain":"www.google.com","ruleset_id":null},{"domain":"local.google.com","ruleset_id":null},{"domain":"search.yahoo.com","ruleset_id":null},{"domain":"www.bing.com","ruleset_id":null},{"domain":"www.facebook.com","ruleset_id":null},{"domain":"www.yelp.com","ruleset_id":null}],"dispatch_start_col":5,"meta_start_line":2,"rules":[{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"label":null,"emit":"var nb_max_perc = 1;\n        var nb_percolated = 0;\n        var PercolationSelector = function(obj) {\n          /* Maximun nb_max_perc percolations */\n          if (nb_percolated < nb_max_perc) {\n             var url = $K(obj).data(\"url\");\n             /* checks if the URL matches with one of the kiimby member business ones */\n             var o = sites_list[url];\n             if (o) {\n               nb_percolated++;\n               return true;\n             }\n             else\n                return false;\n          }\n          else\n            return false;\n        };\n        \n        var image_link;\n        var AnnotationSelector = function(obj) {\n           var url = $K(obj).data(\"url\");\n           /* checks if the URL matches with one of the kiimby member business ones */\n           var o = sites_list[url];\n           if (o) {\n             image_link = '<a href=' + sites_list[url] + '><img style=\"padding-top: 0px\" src=' + url_prefix + km_icon + ' title=\"' + sites_title[url] + '\" border=\"0\"/></a>';\n             return image_link;\n           }\n           else\n            return false;\n        };\n    "},{"action":{"source":null,"name":"percolate","args":[{"val":"PercolationSelector","type":"var"}],"modifiers":[{"value":{"val":[{"rhs":{"val":[{"rhs":{"val":"num=100","type":"str"},"lhs":"resultNumParem"}],"type":"hashraw"},"lhs":"www.google.com"},{"rhs":{"val":[{"rhs":{"val":"num=100","type":"str"},"lhs":"resultNumParem"}],"type":"hashraw"},"lhs":"search.yahoo.com/search"},{"rhs":{"val":[{"rhs":{"val":"num=100","type":"str"},"lhs":"resultNumParem"}],"type":"hashraw"},"lhs":"bing.com/search"}],"type":"hashraw"},"name":"site"}],"vars":null},"label":null},{"action":{"source":null,"name":"annotate_search_results","args":[{"val":"AnnotationSelector","type":"var"}],"modifiers":[{"value":{"val":[{"rhs":{"val":[{"rhs":{"val":"num=100","type":"str"},"lhs":"resultNumParem"}],"type":"hashraw"},"lhs":"www.google.com"},{"rhs":{"val":[{"rhs":{"val":"num=100","type":"str"},"lhs":"resultNumParem"}],"type":"hashraw"},"lhs":"search.yahoo.com/search"},{"rhs":{"val":[{"rhs":{"val":"num=100","type":"str"},"lhs":"resultNumParem"}],"type":"hashraw"},"lhs":"bing.com/search"}],"type":"hashraw"},"name":"site"}],"vars":null},"label":null}],"post":null,"pre":null,"name":"annotate_and_percolate","start_col":1,"emit":null,"state":"active","callbacks":null,"pagetype":{"event_expr":{"pattern":"google.com|bing.com|yahoo.com","legacy":1,"type":"prim_event","vars":[],"op":"pageview"},"foreach":[]},"start_line":45},{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"action":{"source":null,"name":"replace_html","args":[{"val":"#pagelet_adbox","type":"str"},{"val":"iframe","type":"var"}],"modifiers":null,"vars":null},"label":null}],"post":null,"pre":[{"rhs":{"val":"<div id='kiimby_ads'><h1>Kiimby sponsor ads :</h1><iframe id='ab840993' name='ab840993' src='http://preview.kiimby.com:8080/openx/www/delivery/afr.php?zoneid=5&amp;cb={random}&amp;ct0={clickurl}' frameborder='0' scrolling='no' width='160' height='160'><a href='http://preview.kiimby.com:8080/openx/www/delivery/ck.php?n=a89c6100&amp;cb={random}' target='_blank'><img src='http://preview.kiimby.com:8080/openx/www/delivery/avw.php?zoneid=5&amp;cb={random}&amp;n=a89c6100&amp;ct0={clickurl}' border='0' alt='' /></a></iframe></div>","type":"str"},"lhs":"iframe","type":"expr"}],"name":"replace_fb_ads","start_col":2,"emit":null,"state":"active","callbacks":null,"pagetype":{"event_expr":{"pattern":"facebook.com","legacy":1,"type":"prim_event","vars":[],"op":"pageview"},"foreach":[]},"start_line":87},{"cond":{"val":"true","type":"bool"},"blocktype":"every","actions":[{"action":{"source":null,"name":"before","args":[{"val":"#Welcome_Box_300x250","type":"str"},{"val":"msg","type":"var"}],"modifiers":null,"vars":null},"label":null}],"post":null,"pre":[{"rhs":"<iframe id='aab28eb3' name='aab28eb3' src='http://preview.kiimby.com:8080/openx/www/delivery/afr.php?resize=1&amp;refresh=5&amp;zoneid=5&amp;cb={random}&amp;ct0={clickurl}' frameborder='0' scrolling='no' width='160' height='160' allowtransparency='true'><a href='http://preview.kiimby.com:8080/openx/www/delivery/ck.php?n=ad17d06a&amp;cb={random}' target='_blank'><img src='http://preview.kiimby.com:8080/openx/www/delivery/avw.php?zoneid=5&amp;cb={random}&amp;n=ad17d06a&amp;ct0={clickurl}' border='0' alt='' /></a></iframe>\n            \n ","lhs":"msg","type":"here_doc"}],"name":"yelp_ads","start_col":2,"emit":null,"state":"active","callbacks":null,"pagetype":{"event_expr":{"pattern":"yelp.com","legacy":1,"type":"prim_event","vars":[],"op":"pageview"},"foreach":[]},"start_line":98}],"meta_start_col":5,"meta":{"keys":{"errorstack":"9a572c10450fabb21656495be2a84eec"},"logging":"on","name":"kiimby demo","meta_start_line":2,"meta_start_col":5},"dispatch_start_line":8,"global_start_col":5,"ruleset_name":"a25x6"}
