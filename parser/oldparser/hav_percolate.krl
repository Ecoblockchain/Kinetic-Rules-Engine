{"global":[{"emit":"var url_prefix = \"http://frag.kobj.net/clients/hav_percolate/images/\";\n\nsearch_percolate = {};\nsearch_percolate.defaults = {\n  \"name\": \"KOBJ\",\n  \"sep\": \"<div></div>\",\n  \"text_color\":\"#CCC\",\n  \"height\":\"100px\",\n  \"left_margin\": \"0px\",\n  \"right_padding\" : \"15px\",\n  \"font_size\":\"12px\",\n//  \"tail_background_image\": url_prefix+\"hav_percolate.jpg\",\n  \"font_family\": \"Verdana, Geneva, sans-serif\"\n};\n\nfunction annotate_search_results (annotate) {\n\n\n  function mk_list_item(i) {\n    return $K(i).attr(\n      {\"class\": \"KOBJ_item\"\n      }).css(\n        {\"margin-bottom\":\"5px\"\n\n\t});\n  }\n\n  function mk_rm_div (anchor) {\n    var logo_item = mk_list_item(anchor);\n    var logo = $K('<img>').attr(\n      {\"src\":url_prefix+\"hav_percolate.jpg\",\n       \"align\":\"left\",\n       \"padding-right\": \"10px\"\n      });\n    var title = $K(\"<h2>\").text(\"Locals Care Links\").css(\n      {\"margin\": \"3px 3px 0pt\",\n       \"color\": \"#676767\",\n       \"font-size\":\"small\",\n       \"font-family\":\"arial,sans-serif\"\n\n      });\n    var header=$K(\"<div>\").css(\n      {\"float\":\"right\"\n      }).append(logo);\n    var top_box = $K('<ol>').css(\n      {\"display\": \"block\",\n       \"padding-top\": \"18px\"\n       }).attr(\"id\", search_percolate.defaults.name+\"_top_box\").append(logo_item);\n    var inner_div = $K('<div>').css(\n      {\n      }).append(top_box);\n    if (search_percolate.defaults.tail_background_image){\n      inner_div.css({\n           \"background-image\": \"url(\" + search_percolate.defaults.tail_background_image + \")\",\n           \"background-repeat\": \"no-repeat\",\n           \"background-position\": \"right top\"\n\t\t    });\n    }\n    var rm_div = $K('<div>').attr({\"class\":\"cxx\"}).css(\n      {\"border\":\"solid #042A7F\",\n       \"padding-bottom\": \"3px\",\n       \"padding-left\": \"5px\",\n       \"padding-right\": \"5px\",\n       \"max-width\": \"48em\",\n       \"min-height\": \"100px\"\n      }).append(header).append(inner_div);\n    if (search_percolate.defaults.head_background_image){\n     rm_div.css({\n           \"background-image\": \"url(\" + search_percolate.defaults.head_background_image +\")\",\n           \"background-repeat\": \"no-repeat\",\n           \"background-position\": \"left top\"\n\t\t});\n    }\n    return rm_div;\n  }\n\n\n  function move_item (obj) {\n    if($K('#'+search_percolate.defaults.name+'_top_box').find(\"li\").is('.'+search_percolate.defaults.name+'_item')) {\n      $K('#'+search_percolate.defaults.name+'_top_box').append(search_percolate.defaults.sep).append(mk_list_item(obj));\n    } else {\n      if($K('#mbEnd').size() !== 0) {\n        $K(\"#mbEnd\").after(mk_rm_div(obj));\n      } else {\n        $K(\"#ssb\").after(mk_rm_div(obj));\n      }\n    }\n  }\n\n\n\n    $K(\"li.g, li div.res\").each(function() {\n\t\t\t\t  var contents = annotate(this);\n\t\t\t\t  if (contents) {\n\t\t\t\t    move_item(this);\n\t\t\t\t  }\n\t\t\t\t});\n\n\n  var cloc = document.location.toString();\n\n  var m;\n  var start = 0;\n  try { m = cloc.match(/(start)=(\\d+)/);\n\tstart = parseInt(m[2]);\n      } catch(err) {}\n  var next = (start+10).toString();\n  if(m) {\n      cloc = cloc.replace(/start=\\d+/, \"start=\" + next);\n  } else {\n      cloc = cloc + \"&start=\" + next;\n  }\n  cloc += \"&num=50\";\n\n  $K.get(cloc, function(res) {\n\t     $K(\"li.g, li div.res\", res).each(function() {\n\t\t var contents = annotate(this);\n\t\t if (contents) {\n\t\t   move_item(this);\n\t\t }\n\t\t\t\t\t       });\n\t   });\n\n\n}\n\n// this would be in the data set\nvar search_percolate_test = {};\nsearch_percolate_test.hav =\n {\n   \"www.coldstonecreamery.com\" : [\n      {\n         \"link\" : \"http://www.locals-care.com/merch_cntr/viewMerchant.php?mid=4228\",\n         \"city\" : \"Santa Fe\",\n         \"name\" : \"Cold Stone\"\n      }\n   ],\n   \"www.cort.com\" : [\n      {\n         \"link\" : \"http://www.locals-care.com/merch_cntr/viewMerchant.php?mid=7056\",\n         \"city\" : \"Santa Fe\",\n         \"name\" : \"Cort Furniture\"\n      }\n   ],\n   \"www.lightingdesign.com\" : [\n      {\n         \"link\" : \"http://www.locals-care.com/merch_cntr/viewMerchant.php?mid=6741\",\n         \"city\" : \"Santa Fe\",\n         \"name\" : \"Lighting Design\"\n      }\n   ],\n };\n\n\n// this would be in the ruleset global or an emit\n\nfunction hav_selector(obj){\n  function mk_anchor (o, key) {\n    var url_prefix = \"http://frag.kobj.net/clients/1024/images/\";\n\n    var link_text = {\n      \"hav\": \"<img style='padding-top: 5px' src='\" + url_prefix + \"boa_logo_34.png' border='0'>\"\n    };\n\n    return $K('<a href=' + o.link + '/>').attr(\n      {\"class\": 'KOBJ_'+key,\n       \"title\": o.text || \"Click here for discounts!\"\n      }).html(link_text[key]);\n  }\n\n  function get_host(s) {\n    var h = \"\";\n    try {\n      h = s.match(/^(?:\\w+:\\/\\/)?([\\w.]+)/)[1];\n    } catch(err) {\n    }\n    return h;\n  }\n\n  var host = get_host($K(obj).find(\"span.url, cite\").text());\n  var o = KOBJ.pick(search_percolate_test.hav[host]);\n  if(o) {\n     return mk_anchor(o,'hav');\n  } else {\n     return false;\n  }\n}\n\n\n"}],"global_start_line":12,"dispatch":[],"dispatch_start_col":null,"meta_start_line":4,"rules":[{"cond":{"args":[],"function_expr":{"val":"truth","type":"var"},"type":"app"},"blocktype":"every","actions":[{"label":null,"emit":"annotate_search_results(hav_selector);\n    "}],"post":null,"pre":[],"name":"hav_percolate","start_col":2,"emit":null,"state":"active","callbacks":null,"pagetype":{"event_expr":{"pattern":"www.google.com","legacy":1,"type":"prim_event","vars":[],"op":"pageview"},"foreach":[]},"start_line":209}],"meta_start_col":3,"meta":{"logging":"on","meta_start_line":4,"description":"Move local search results to the top of the Google search results.\n","meta_start_col":3},"dispatch_start_line":null,"global_start_col":3,"ruleset_name":"hav_percolate"}
