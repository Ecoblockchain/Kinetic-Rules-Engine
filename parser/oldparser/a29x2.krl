{"global":[{"source":"http://itlab.stanford.edu/library/isbnsearch?","name":"library_search","type":"datasource","datatype":"JSON","cachable":0},{"source":"http://itlab.stanford.edu/library/debug?","name":"library_debug","type":"datasource","datatype":"JSON","cachable":0},{"emit":"function sultest_othereds () {        var txt = \"UNKNOWN\";        var links = document.getElementsByTagName(\"A\");        var eds = [];        for (i = 0; i < links.length; i++) {          if (links[i].href.match(/\\/ref=ed_oe_.*/)) {            console.debug(\"Looking at \" + links[i].href);            dp = links[i].href.match(/dp\\/\\d+/);            if (dp && dp.length > 0) {              p = dp[0].split('/');              eds[links[i].nodeValue] = p[1];            }          }        }        if (eds.length > 0) {          txt = \"\";          for (var ed in eds) {            txt = txt + (txt == \"\" ? \"\" : \"&\") + ed + \"=\" + eds[ed];          }        }        return txt;      };          var othereds = sultest_othereds();                "}],"global_start_line":11,"dispatch":[{"domain":"amazon.com","ruleset_id":null}],"dispatch_start_col":5,"meta_start_line":2,"rules":[{"cond":{"args":[{"val":"title","type":"var"},{"val":"","type":"str"}],"type":"ineq","op":"neq"},"blocktype":"every","actions":[{"action":{"source":null,"name":"notify","args":[{"val":"Stanford Libraries","type":"str"},{"val":"msg","type":"var"}],"modifiers":[{"value":{"val":"true","type":"bool"},"name":"sticky"}],"vars":null},"label":null}],"post":null,"pre":[{"rhs":{"source":"datasource","predicate":"library_search","args":[{"args":[{"val":"rule=amazonproducturl&isbn=","type":"str"},{"val":"isbn","type":"var"}],"type":"prim","op":"+"}],"type":"qualified"},"lhs":"book_data","type":"expr"},{"rhs":{"obj":{"val":"book_data","type":"var"},"args":[{"val":"$.title","type":"str"}],"name":"pick","type":"operator"},"lhs":"title","type":"expr"},{"rhs":{"obj":{"val":"book_data","type":"var"},"args":[{"val":"$.url","type":"str"}],"name":"pick","type":"operator"},"lhs":"url","type":"expr"},{"rhs":{"source":"datasource","predicate":"library_debug","args":[{"args":[{"val":"title=","type":"str"},{"args":[{"val":"title","type":"var"},{"args":[{"val":"&url=","type":"str"},{"val":"url","type":"var"}],"type":"prim","op":"+"}],"type":"prim","op":"+"}],"type":"prim","op":"+"}],"type":"qualified"},"lhs":"debug","type":"expr"},{"rhs":"Stanford Libraries has this book.    Click here to see <a id=\"MLN_link\" href=\"#{url}\">#{title}</a>.  \n ","lhs":"msg","type":"here_doc"}],"name":"amazonproducturl","start_col":5,"emit":null,"state":"active","callbacks":{"success":[{"attribute":"class","trigger":null,"value":"MLN_link","type":"click"}],"failure":null},"pagetype":{"event_expr":{"pattern":"www.amazon.com/gp/product/(\\d+)","legacy":1,"type":"prim_event","vars":["isbn"],"op":"pageview"},"foreach":[]},"start_line":17},{"cond":{"args":[{"val":"title","type":"var"},{"val":"","type":"str"}],"type":"ineq","op":"neq"},"blocktype":"every","actions":[{"action":{"source":null,"name":"notify","args":[{"val":"Stanford Libraries","type":"str"},{"val":"msg","type":"var"}],"modifiers":[{"value":{"val":"true","type":"bool"},"name":"sticky"}],"vars":null},"label":null}],"post":null,"pre":[{"rhs":{"source":"datasource","predicate":"library_search","args":[{"args":[{"val":"rule=amazonotheredition&isbn=","type":"str"},{"val":"isbn","type":"var"}],"type":"prim","op":"+"}],"type":"qualified"},"lhs":"book_data","type":"expr"},{"rhs":{"obj":{"val":"book_data","type":"var"},"args":[{"val":"$.title","type":"str"}],"name":"pick","type":"operator"},"lhs":"title","type":"expr"},{"rhs":{"obj":{"val":"book_data","type":"var"},"args":[{"val":"$.url","type":"str"}],"name":"pick","type":"operator"},"lhs":"url","type":"expr"},{"rhs":{"source":"datasource","predicate":"library_debug","args":[{"args":[{"val":"othereds=","type":"str"},{"val":"othereds","type":"var"}],"type":"prim","op":"+"}],"type":"qualified"},"lhs":"debug","type":"expr"},{"rhs":"Stanford Library has an alternative edition of this book.    Click here to see <a id=\"MLN_link\" href=\"#{url}\">#{title}</a>.  \n ","lhs":"msg","type":"here_doc"}],"name":"amazonothereditions","start_col":5,"emit":null,"state":"active","callbacks":{"success":[{"attribute":"class","trigger":null,"value":"MLN_link","type":"click"}],"failure":null},"pagetype":{"event_expr":{"pattern":"www.amazon.com/.*/dp/(\\d+)/","legacy":1,"type":"prim_event","vars":[],"op":"pageview"},"foreach":[]},"start_line":41},{"cond":{"args":[{"val":"title","type":"var"},{"val":"","type":"str"}],"type":"ineq","op":"neq"},"blocktype":"every","actions":[{"action":{"source":null,"name":"notify","args":[{"val":"Stanford Libraries","type":"str"},{"val":"msg","type":"var"}],"modifiers":[{"value":{"val":"true","type":"bool"},"name":"sticky"}],"vars":null},"label":null}],"post":null,"pre":[{"rhs":{"source":"datasource","predicate":"library_search","args":[{"args":[{"val":"rule=amazonpageurl&isbn=","type":"str"},{"val":"isbn","type":"var"}],"type":"prim","op":"+"}],"type":"qualified"},"lhs":"book_data","type":"expr"},{"rhs":{"obj":{"val":"book_data","type":"var"},"args":[{"val":"$.title","type":"str"}],"name":"pick","type":"operator"},"lhs":"title","type":"expr"},{"rhs":{"obj":{"val":"book_data","type":"var"},"args":[{"val":"$.url","type":"str"}],"name":"pick","type":"operator"},"lhs":"url","type":"expr"},{"rhs":{"source":"datasource","predicate":"library_debug","args":[{"args":[{"val":"title=","type":"str"},{"args":[{"val":"title","type":"var"},{"args":[{"val":"&url=","type":"str"},{"val":"url","type":"var"}],"type":"prim","op":"+"}],"type":"prim","op":"+"}],"type":"prim","op":"+"}],"type":"qualified"},"lhs":"debug","type":"expr"},{"rhs":"Stanford Libraries has this book.    Click here to see <a id=\"MLN_link\" href=\"#{url}\">#{title}</a>.  \n ","lhs":"msg","type":"here_doc"}],"name":"amazonpageurl","start_col":5,"emit":null,"state":"active","callbacks":{"success":[{"attribute":"class","trigger":null,"value":"MLN_link","type":"click"}],"failure":null},"pagetype":{"event_expr":{"pattern":"www.amazon.com/.*/dp/(\\d+)/","legacy":1,"type":"prim_event","vars":["isbn"],"op":"pageview"},"foreach":[]},"start_line":65}],"meta_start_col":5,"meta":{"logging":"on","meta_start_line":2,"description":"Check for books viewed at Amazon in SUL catalog \n","meta_start_col":5},"dispatch_start_line":8,"global_start_col":5,"ruleset_name":"a29x2"}
